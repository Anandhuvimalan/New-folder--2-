{% extends "base.html" %}
{% block title %}Dashboard - Student Management{% endblock %}
{% block content %}
  <h2>Dashboard Overview</h2>
  
  <div class="stats-grid">
    <div class="stat-card">
      <h3>Total Students</h3>
      <div class="number">{{ students|length }}</div>
    </div>
    <div class="stat-card">
      <h3>Total Courses</h3>
      <div class="number">{{ courses|length }}</div>
    </div>
    <div class="stat-card">
      <h3>Active Enrollments</h3>
      <div class="number">{{ enrollments|length }}</div>
    </div>
    <div class="stat-card">
      <h3>Total Payments</h3>
      <div class="number">{{ payments|length }}</div>
    </div>
  </div>

  <div class="quick-actions">
    <h2>Quick Actions</h2>
    <div class="row">
      <div class="section">
        <h3>Add New Student</h3>
        <form method="post" action="{{ url_for('ui_create_student') }}">
          <label>Register Number</label>
          <input type="number" name="register_number" required>
          <label>Student Name</label>
          <input type="text" name="student_name" required>
          <button type="submit">Add Student</button>
        </form>
      </div>

      <div class="section">
        <h3>Add New Course</h3>
        <form method="post" action="{{ url_for('ui_create_course') }}">
          <label>Course Name</label>
          <input type="text" name="course_name" required>
          <button type="submit">Add Course</button>
        </form>
      </div>
    </div>

    <div class="row">
      <div class="section">
        <h3>Enroll Student</h3>
        <form method="post" action="{{ url_for('ui_create_enrollment') }}">
          <label>Select Student</label>
          <select name="student_id" required>
            <option value="">-- Choose Student --</option>
            {% for s in students %}
              <option value="{{ s.register_number }}">{{ s.register_number }} - {{ s.student_name }}</option>
            {% endfor %}
          </select>

          <label>Select Course</label>
          <select name="course_id" required>
            <option value="">-- Choose Course --</option>
            {% for c in courses %}
              <option value="{{ c.id }}">{{ c.course_name }}</option>
            {% endfor %}
          </select>

          <button type="submit">Enroll Student</button>
        </form>
      </div>

      <div class="section">
        <h3>Record Payment</h3>
        <form method="post" action="{{ url_for('ui_create_payment') }}">
          <label>Select Enrollment</label>
          <select name="student_course_id" required>
            <option value="">-- Choose Enrollment --</option>
            {% for e in enrollments %}
              <option value="{{ e.id }}">
                {% if e.students %}{{ e.students.student_name }}{% else %}Student {{ e.student_id }}{% endif %}
                - 
                {% if e.courses %}{{ e.courses.course_name }}{% else %}Course {{ e.course_id }}{% endif %}
              </option>
            {% endfor %}
          </select>

          <label>Amount Paid</label>
          <input type="number" name="amount_paid" min="0" required>

          <button type="submit">Record Payment</button>
        </form>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>Recent Activity</h2>
    <h3>Latest Payments</h3>
    <table>
      <tr>
        <th>Student</th>
        <th>Course</th>
        <th>Amount</th>
        <th>Date</th>
      </tr>
      {% for p in payments[:5] %}
        <tr>
          <td>{% if p.student_courses and p.student_courses.students %}{{ p.student_courses.students.student_name }}{% else %}-{% endif %}</td>
          <td>{% if p.student_courses and p.student_courses.courses %}{{ p.student_courses.courses.course_name }}{% else %}-{% endif %}</td>
          <td>â‚¹{{ p.amount_paid }}</td>
          <td>{{ p.paid_at[:10] if p.paid_at else '-' }}</td>
        </tr>
      {% endfor %}
    </table>
  </div>
{% endblock %}
